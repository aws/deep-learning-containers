#!/bin/bash

HOME_DIR=/test
BIN_DIR=${HOME_DIR}/bin
LOG_DIR=${HOME_DIR}/logs

DGL_RELEASE_TAG=$(python -c "import dgl; dgl_versions = dgl.__version__.split('.'); print(f'{dgl_versions[0]}.{dgl_versions[1]}.x')")
USE_NEW=$(python -c "import dgl; dgl_versions = dgl.__version__.split('.'); print(1 if int(dgl_versions[1]) >= 9 else 0)")

git clone -b ${DGL_RELEASE_TAG} https://github.com/dmlc/dgl.git ${HOME_DIR}/artifacts/dgl

if [ ${USE_NEW} -eq 1 ]; then
  ${BIN_DIR}/dgl_tests/testDGLHelperNew python pytorch || exit 1
else
  ${BIN_DIR}/dgl_tests/testDGLHelper python pytorch || exit 1
fi

exit 0
