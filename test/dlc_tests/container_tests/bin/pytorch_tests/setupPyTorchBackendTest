#!/bin/bash

HOME_DIR=/test

git config --global user.email "you@example.com"
git config --global user.name "Your Name"

# activate conda env (to prevent duplicate pip install)
conda init
source ~/.bashrc

# setup benchmark repo
git clone https://github.com/pytorch/benchmark
pushd benchmark
git am 0001-test-adapt-BERT_pytorch-training-with-gloo-backend.patch
pip install -r requirements.txt

# check GPU status
if nvidia-smi &> /dev/null; then
   DEVICE="cuda"
else
   DEVICE="cpu"
fi
