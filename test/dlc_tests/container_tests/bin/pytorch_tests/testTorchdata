#!/bin/bash

HOME_DIR=/test
BIN_DIR=${HOME_DIR}/bin
LOG_DIR=${HOME_DIR}/logs

S3_IO_DEV_BRANCH="s3-datapipes"
S3_IO_DEV_REPO="https://github.com/ydaiming/data.git"
S3_IO_TEST_SCRIPT="data/test/test_remote_io.py"

echo "Fetch Torchdata S3 IO test script."
git clone --recursive -b ${S3_IO_DEV_BRANCH} ${S3_IO_DEV_REPO}

echo "Installing pre-requisites."
pip install expecttest

echo "Running Torchdata S3 IO datapipe tests."
python ${S3_IO_TEST_SCRIPT}

if [ "$?" -eq "0" ]
then
    echo "Torchdata S3 IO tests succeeded."
else
    echo "Torchdata S3 IO tests failed at ${S3_IO_DEV_REPO} ${S3_IO_DEV_BRANCH} ${S3_IO_TEST_SCRIPT}"
    exit 1
fi

echo "Torchdata S3 IO tests succeeded!"
exit 0
